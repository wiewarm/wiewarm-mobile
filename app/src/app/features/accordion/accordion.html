<div class="container-lg">
  <div class="list-header">
    @if(badResource.isLoading()) {
    <div class="status" role="status" aria-live="polite">
      <span aria-hidden="true">â³ </span>Ladenâ€¦
    </div>
    } @else if(badResource.error()) {
    <div class="status error" role="alert" aria-live="assertive">
      <span aria-hidden="true">âŒ </span>
      Fehler beim Laden. Bitte versuchen Sie es spÃ¤ter erneut.
    </div>
    } @else {
    <div class="favorite-box" *ngIf="favorite() as fav">
      <span class="favorite-name"
        ><span class="material-icons favorite-icon">star</span>
        <span>{{ fav.bad }}</span></span
      >
      <span class="favorite-location">{{ fav.plz}} {{ fav.ort }}</span>
      <span class="favorite-temp" [ngClass]="temperatureClass(fav.temp)"
        >{{ fav.temp != null ? fav.temp + 'Â°C' : 'â€”' }}</span
      >
    </div>
    <div class="search">
      <span class="search-emoji" aria-hidden="true">ğŸ”</span>
      <input
        type="text"
        [(ngModel)]="searchInput"
        placeholder="Sucheâ€¦"
        aria-label="Badi suchen"
      />
    </div>
    <a
      href="#"
      class="sort-link"
      aria-haspopup="dialog"
      aria-controls="sort-dialog"
      (click)="sortDialog.open();"
      ><span aria-hidden="true">ğŸ”½</span>
      <span class="sort-text">Sortieren</span> </a
    >}
  </div>

  <app-sort-dialog
    #sortDialog
    [sortField]="sortField"
    [setSort]="setSort"
  ></app-sort-dialog>

  <cdk-virtual-scroll-viewport
    class="item-viewport"
    [itemSize]="72"
    orientation="vertical"
  >
    <span class="accordion" cdkAccordion>
      @if(!badResource.isLoading() && !badResource.error() &&
      filteredItems().length === 0) {
      <div class="status" role="status">
        <span aria-hidden="true">ğŸ˜• </span>Keine Resultate gefunden.
      </div>
      } @for(item of filteredItems(); track item.beckenid; let i = $index) {
      <section class="accordion-item">
        <cdk-accordion-item cdk-accordion-item #accItem="cdkAccordionItem">
            <button
              [attr.id]="'acc-header-' + i"
              class="accordion-header"
              (click)="accItem.toggle()"
              type="button"
              [attr.aria-expanded]="accItem.expanded"
              [attr.aria-controls]="'acc-body-' + i"
            >
              <span class="accordion-header-left">
                <h3 class="accordion-header-title">{{item.becken}}</h3>
                <span class="accordion-header-subtitle">
                  {{ item.plz ? item.plz + ' ' : '' }}{{ item.ort }}
                  @if(item.kanton) {
                  <img
                    class="kanton-wappen"
                    [src]="'assets/img/wappen/' + (item.kanton | lowercase) + '.svg'"
                    [attr.alt]="(item.kanton | titlecase) + ' Wappen'"
                    width="18"
                    height="18"
                    loading="lazy"
                  />
                  <!-- ToDo: use sprite -->
                  }
                </span>
              </span>
              <span class="accordion-header-right">
                <span class="temp-label">
                  <span
                    class="temp-dot"
                    [ngClass]="temperatureClass(item.temp)"
                  ></span>
                  {{ item.temp != null ? item.temp + 'Â°C' : 'â€”' }}
                </span>
              </span>
            </button>
          @if(accItem.expanded) {
          <div
            [attr.id]="'acc-body-' + i"
            class="accordion-body"
            role="region"
            [attr.aria-labelledby]="'acc-header-' + i"
          >
            <div class="accordion-body-left">
              <p>{{ item.bad }}</p>
              <a class="detail-link" [routerLink]="[item.beckenid]">
                <span class="detail-text">Details</span> &rarr;</a
              >
            </div>
            <div class="accordion-body-right">
              <p
                class="time-label"
                [ngClass]="{ 'label-older-than-one-month': isOlderThanOneMonth(item.date) }"
              >
                Zuletzt aktualisiert: {{ item.date_pretty }} ğŸ”„
              </p>
              <button
                class="favorite-button material-icons"
                [attr.aria-label]="isFavorite(item) ? 'Favorit entfernen' : 'Als Favorit speichern'"
                (click)="toggleFavorite(item); $event.stopPropagation();"
              >
                {{ isFavorite(item) ? 'star' : 'star_border' }}
              </button>
            </div>
          </div>
          }
        </cdk-accordion-item>
      </section>
      }
    </span>
  </cdk-virtual-scroll-viewport>
</div>
